# 로컬스토리지 기반 인증 구현에 대한 설명

이 문서는 우리 가계부 애플리케이션에서 SQL 데이터베이스 대신 브라우저의 localStorage를 사용하여 인증 및 데이터 저장을 구현한 이유와 그 방식에 대해 설명합니다.

## 1. SQL 대신 로컬스토리지를 사용한 이유

### 클라이언트 측 환경의 제약
가계부 앱은 웹팩 5를 사용하는 React 기반의 클라이언트 측 애플리케이션으로, SQL 데이터베이스 연결을 직접적으로 사용하기 어려운 환경적 제약이 있었습니다. 특히:

1. **Node.js 폴리필 문제**: 웹팩 5는 이전 버전과 달리 자동으로 Node.js 코어 모듈을 폴리필하지 않습니다. 따라서 브라우저 환경에서 `bcryptjs`, `jsonwebtoken` 등 서버 측 모듈을 사용할 때 문제가 발생했습니다.

2. **보안 및 아키텍처 문제**: 프론트엔드 코드에서 직접 데이터베이스에 연결하는 것은 보안상 큰 위험을 초래합니다. 데이터베이스 자격 증명이 노출될 위험이 있고, 사용자가 직접 데이터베이스를 조작할 수 있게 됩니다.

3. **오프라인 기능 지원**: 앱이 서버 없이 독립적으로 동작할 수 있도록 하기 위해, 로컬스토리지를 사용하여 오프라인 환경에서도 기본 기능을 사용할 수 있게 했습니다.

### 폴백 메커니즘으로서의 로컬스토리지
이 구현은 실제 프로덕션 환경을 위한 완벽한 솔루션이 아닌, 개발 단계에서의 폴백 메커니즘입니다. 향후 백엔드 서버가 개발되면 로컬스토리지 기반 시뮬레이션은 실제 서버 API 호출로 대체될 예정입니다.

## 2. 현재 인증 구현의 보안 측면

현재 로컬스토리지 기반 인증 구현은 다음과 같은 보안 기능을 포함하고 있습니다:

1. **향상된 비밀번호 해싱**: 단순 Base64 인코딩 대신, PBKDF2와 유사한 방식으로 비밀번호를 해싱합니다. 솔트(Salt)를 추가하고 반복 해싱을 통해 보안을 강화했습니다.

2. **토큰 기반 인증**: JWT와 유사한 방식의 토큰을 생성하여, 서버 측 세션 관리와 비슷한 방식으로 사용자 인증을 처리합니다.

3. **세션 관리**: 토큰에 만료 시간을 설정하고, 사용자 에이전트를 검증하여 세션 하이재킹을 방지합니다.

4. **자동 로그아웃**: 일정 시간 동안 활동이 없으면 자동으로 로그아웃되는 기능이 있습니다.

5. **보안 강화된 에러 처리**: 인증 실패 시 최소한의 정보만 노출하여 공격 벡터를 줄였습니다.

## 3. 구현 구조

로컬스토리지 기반 인증 및 데이터 저장 시스템은 다음과 같은 구조로 구현되었습니다:

### 인증 서비스 (authService.js)
- 회원가입, 로그인, 토큰 검증 등 인증 관련 기능 구현
- 브라우저 환경에서 작동하는 암호화 방식 구현
- 토큰 기반 세션 관리

### 데이터 서비스 (dbServiceWrapper.js)
- 사용자별 데이터 저장 및 불러오기 기능
- 카테고리 관리, 트랜잭션 기록, 분석 등 기능 제공
- 사용자 인증 상태에 따른 데이터 접근 제어

### 마이그레이션 유틸리티 (migrationUtil.js)
- 로컬스토리지에 저장된 데이터를 사용자 계정과 연결하여 이전
- 이후 서버 기반 시스템으로 마이그레이션 할 때 사용 가능한 유틸리티

## 4. 제한사항 및 향후 개선 방향

현재 구현의 제한사항:

1. **보안의 한계**: 클라이언트 측 저장소는 근본적으로 사용자가 접근할 수 있어 보안에 취약합니다.
2. **스토리지 제한**: 로컬스토리지는 용량이 제한되어 있어(대략 5MB) 많은 데이터를 저장하기 어렵습니다.
3. **동기화 문제**: 여러 기기에서 동일한 계정을 사용할 경우 데이터 동기화가 불가능합니다.

향후 개선 방향:

1. **백엔드 서버 개발**: RESTful API 또는 GraphQL을 제공하는 백엔드 서버를 개발하여 실제 데이터베이스와 연결
2. **단계적 마이그레이션**: 사용자가 계정을 생성하면 로컬 데이터를 서버로 마이그레이션하는 기능 구현
3. **하이브리드 접근법**: 오프라인 기능을 위한 로컬스토리지 캐싱과 온라인 동기화 기능 병행

## 결론

현재의 로컬스토리지 기반 구현은 개발 단계에서의 임시 해결책이며, 웹팩 5의 Node.js 폴리필 문제를 해결하면서 기본적인 기능을 제공합니다. 그러나 실제 프로덕션 환경에서는 보안과 확장성을 위해 백엔드 서버 기반의 구현으로 전환할 필요가 있습니다.
